# 遥控器模拟控制说明

## 背景问题

使用 `Move(vx, vy, wz)` API 控制机器人时，如果同时设置前进速度和转向速度（相当于右摇杆斜打），机器人会原地转圈。

但用真实遥控器操作时：
- **左摇杆推满前进** + **右摇杆只打转向** → 机器人可以正常走圆

这说明机器人内部对"分开打杆"和"斜打"的处理方式不同。

## 快速开始

### 运行程序

```bash
# 打开 robowork，点击 Terminal（每次更换电池后需要重新运行）
cd /Downloads/booster_robotics_sdk
sudo bash -c "source /opt/ros/humble/setup.bash && python3 move_rc_sim.py"
```

### 强制关闭程序

```bash
sudo pkill -9 -f move_rc_sim.py
```

## 手柄操作说明

| 操作 | 功能 |
|------|------|
| **LT + RT + 十字键上** | 暂停/继续（切换手动/自动模式） |
| **LT + RT + 十字键左** | 切换到左圈模式（需先暂停） |
| **LT + RT + 十字键右** | 切换到右圈模式（需先暂停） |
| **LT + RT + 十字键下** | 切换到直走模式（需先暂停） |

### 操作流程

1. 程序启动后自动开始走左圈
2. 按 **LT + RT + 上** 暂停（进入手动模式）
3. 手动用遥控器控制机器人走一段
4. 按 **LT + RT + 左/右/下** 切换方向
5. 按 **LT + RT + 上** 继续自动走圈

## 关键技术细节

### 遥控器模拟参数

| 参数 | 说明 | 示例值 |
|------|------|--------|
| `event` | **必须设置为1536** | 1536 |
| `ly` | 左摇杆Y轴（负值=前进） | -1.0 |
| `lx` | 左摇杆X轴（侧移） | 0.0 |
| `rx` | 右摇杆X轴（负值=左转，正值=右转） | -1.0 或 +1.0 |
| `ry` | 右摇杆Y轴（不用） | 0.0 |

### 预热机制

为避免原地转圈，程序在每次开始走圆弧前会：
1. 先只发送前进指令（ly=-1, rx=0）持续 0.8 秒
2. 建立前进速度后再加入转向（rx=-1 或 +1）

## 文件说明

| 文件 | 说明 |
|------|------|
| `move_rc_sim.py` | 遥控器模拟走圆程序（推荐使用） |
| `move.py` | 原始版本，使用 Move() API |
| `rc_monitor.py` | 遥控器状态监控脚本 |

## 注意事项

1. **按错键位不要紧**：程序会自动忽略不完整的组合键
2. **切换模式时**：按完整组合键 LT+RT+方向键，然后释放
3. **程序卡死时**：使用 `sudo pkill -9 -f move_rc_sim.py` 强制关闭

## 修改历史

| 日期 | 修改内容 |
|------|----------|
| 2025-12-29 | 添加 SDK 操作锁，避免发布和订阅冲突导致卡死 |
| 2025-12-29 | 修复 wait_duration 死循环问题 |
| 2025-12-29 | 使用 RLock 替代 Lock，避免嵌套死锁 |
| 2025-12-29 | 添加信号处理，Ctrl+C 可强制退出 |
| 2025-12-29 | 添加预热直走功能（`WARMUP_STRAIGHT_TIME`） |
| 2025-12-29 | 创建 `move_rc_sim.py`，使用遥控器模拟方式控制 |
| 2025-12-29 | 发现关键参数 `event=1536`，修复机器人不响应问题 |

